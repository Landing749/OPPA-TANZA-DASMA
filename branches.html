<!doctype html>
<head>
<meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" />
<title>OPPA — Branches</title>
<link rel="stylesheet" href="styles.css" />
</head>
<body>
<header class="header">
<img src="/assets/logo.png" class="logo" alt="OPPA logo" />
<nav class="nav">
<a href="index.html">Home</a>
<a href="tournaments.html">Tournaments</a>
<a href="rankings.html">Rankings</a>
<a href="players.html">Players</a>
<a href="merch.html">Merch</a>
<a href="branches.html">Branches</a>
<a href="rules.html">Rules</a>
</nav>
</header>


<main class="container">
<h1 class="h1">Branches</h1>


<div class="card">
<div class="branch-tabs" id="branchTabs"></div>
<div id="branchContent"></div>
</div>
</main>


<script type="module" src="firebase.js"></script>
<script type="module">
import { db } from './firebase.js';
import { ref, onValue } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";


const branchTabs = document.getElementById('branchTabs');
const branchContent = document.getElementById('branchContent');


let branches = {};
let players = {};
let tournaments = {};
let current = null;


function renderTabs(){
branchTabs.innerHTML = '';
const keys = Object.keys(branches || {});
if(!keys.length) { branchTabs.innerHTML = '<i>No branches</i>'; return; }
if(!current) current = keys[0];
for(const b of keys){
const btn = document.createElement('button');
btn.className = 'branch-btn ' + (b===current ? 'active':'' );
btn.textContent = b.charAt(0).toUpperCase()+b.slice(1);
btn.onclick = ()=> { current = b; renderTabs(); renderContent(); };
branchTabs.appendChild(btn);
}
}


function renderContent(){
const b = branches[current] || {};
const playerIds = b.players || [];
const branchTournaments = Object.entries(tournaments).filter(([id,t]) => (t.branch||'').toLowerCase()===current.toLowerCase());
branchContent.innerHTML = `<h3 class="h2">${current.charAt(0).toUpperCase() + current.slice(1)} Branch</h3>
<div class="card"><strong>Players</strong><div style="margin-top:8px">${playerIds.map(id => `<div style="padding:6px 0">${(players[id] && players[id].name) || id} • ${players[id]?.class || ''}</div>`).join('') || '<i>No players assigned</i>'}</div></div>
<div class="card"><strong>Tournaments</strong><div style="margin-top:8px">${branchTournaments.map(([id,t])=>`<div style="padding:6px 0">${t.name} • ${t.date||'TBA'}</div>`).join('') || '<i>No tournaments for this branch</i>'}</div></div>`;
}


onValue(ref(db,'branches'), snap => { branches = snap.val() || {}; renderTabs(); renderContent(); });
onValue(ref(db,'players'), snap => { players = snap.val() || {}; renderContent(); });
onValue(ref(db,'tournaments'), snap => { tournaments = snap.val() || {}; renderContent(); });
</script>
</body>
</html>
